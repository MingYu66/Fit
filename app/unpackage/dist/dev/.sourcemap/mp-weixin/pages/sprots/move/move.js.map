{"version":3,"sources":["uni-app:///main.js",null,"webpack:///G:/idea/mint/Aknngsa/boheApp/pages/sprots/move/move.vue?9558","webpack:///G:/idea/mint/Aknngsa/boheApp/pages/sprots/move/move.vue?049b","webpack:///G:/idea/mint/Aknngsa/boheApp/pages/sprots/move/move.vue?109e","uni-app:///pages/sprots/move/move.vue","webpack:///G:/idea/mint/Aknngsa/boheApp/pages/sprots/move/move.vue?bc81","webpack:///G:/idea/mint/Aknngsa/boheApp/pages/sprots/move/move.vue?fc7f"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","latitude","longitude","route","polyline","markers","timer","timer_time","seconds","running","currentStatus","tabBarList","text","iconPath","visible","weight","sprot","img","name","isSubmit","computed","formattedTime","methods","getCurrentLocation","uni","type","success","points","color","width","fail","console","startRunning","stopRunning","clearInterval","id","title","height","content","cType","cValue","cName","cId","cImg","uid","cNum","cWeight","createTime","calculateDistance","p2","total","getDistance","Math","calculateCalories","convertToCanvasCoord","x","y","exportTrackImage","icon","ctx","canvasId","urls","onLoad","scope","that"],"mappings":";;;;;;;;;;;;;AAAA;AAE2D;AAC3D;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,aAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAA6H;AAC7H;AACwD;AACL;AACsC;;;AAGzF;AAC4K;AAC5K,gBAAgB,6KAAU;AAC1B,EAAE,0EAAM;AACR,EAAE,2FAAM;AACR,EAAE,oGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,+FAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAA8oB,CAAgB,8mBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACqFlqB;AAAA,eAEA;EACAC;IACA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MACAC;MAAA;MACAC;MAAA;MACAC;MACAC;QACAC;QACAC;MACA,GACA;QACAD;QACAC;MACA,EACA;MACAC;MACAC;MACAC;QACAC;QACAC;QACAC;MAEA;IACA;EACA;EACAC;IACA;IACAC;MACA;MACA;MACA;MACA;IACA;EACA;EACAC;IACA;IACAC;MAAA;MACAC;QACAC;QACAC;UACA;UACA;UAEA;YACA;YACA;cACAzB;cACAC;YACA;YACA;YACA;cACAyB;cACAC;cACAC;YACA;UACA;QACA;QACAC;UACAC;QACA;MACA;IACA;IAEA;IACAC;MAAA;MACA;QACAD;QACA;MAGA;QACAA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;UACA;QAEA;QACA;QACA;UACA;QACA;MACA;IAEA;IAEA;IACAE;MACA;MACAC;MACAA;MAEA;MAEA;QACA;QACA;UACAC;UACAlC;UACAC;UACAkC;UACAvB;UACAgB;UACAQ;QACA,GACA;UACAF;UACAlC;UACAC;UACAkC;UACAvB;UACAgB;UACAQ;QACA,EACA;QAEA;QACA;QAEAb;UACAY;UACAE;QACA;QACAP;QACAA;QAEA;UACAQ;UACAC;UACAC;UACAC;UACAC;UACAC;UACAC;UACAC;UACAC;QACA;QACAhB;QACA;UACAP;YACAxB;UACA;YACA+B;YACA,2BAEA;UAEA;QACA;MAMA;IACA;IAEA;IACAiB;MACA;MACA;QACA;UACAC;QACAC;MACA;MACA;IACA;IAEA;IACAC;MACA;MACA;MACA;MACA,QACAC,0CACAA,kEACAA;MACA;MACA;IACA;IAEA;IACAC;MAEA;MACA;MACA;MACA;MACA;IACA;IAEA;IACAC;MACA;MACA;QACAC;QACAC;MACA;IACA;IAEAC;MAAA;MACA;QACAjC;UACAY;UACAsB;QACA;QACA;MACA;MACA;QACAlC;UACAY;UACAsB;QACA;QACA;MACA;;MAGA;MACA;MACA;MAEA;;MAEA;MACA;MACA;;MAEA;MACA;QAAA;MAAA;MACA;QAAA;MAAA;MACA;MACA;MACA;MACA;MAEA;MACA;MACA;MAEA;MACA;MACA;;MAEA;MACA;MACA;;MAEA;MACA;QACA;UACAH;UACAC;QACA;MACA;;MAEA;;MAEA;MACAG;MACAA;;MAEA;MACA;;MAEA;MACAA;MACAA;MACAA;MACAA;MACAhC;QAAA;MAAA;MACAgC;;MAEA;MACAA;MACAA;MACAA;MACAA;MAEAA;MACAA;MACAA;MACAA;;MAEA;MACAA;QACAnC;UACAoC;UACAlC;YACAF;cACAqC;YACA;UACA;UACA/B;YACAC;YACAP;cACAY;cACAsB;YACA;UACA;QACA;MACA;IACA;EAKA;EAIA;EACAI;IACA;IACA;MACAtC;QACAuC;QACArC;UACA;UACAsC;QAEA;QACAlC;UACAN;YACAY;YACAsB;UACA;QACA;MACA;MACA;MACA;QACA;MACA;IACA;MACA;IACA;EAIA;AACA;AAAA,2B;;;;;;;;;;;;;ACtbA;AAAA;AAAA;AAAA;AAAqvC,CAAgB,qnCAAG,EAAC,C;;;;;;;;;;;ACAzwC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/sprots/move/move.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;import '@dcloudio/vue-cli-plugin-uni/packages/uni-cloud/dist/index.js';\nimport Vue from 'vue'\nimport Page from './pages/sprots/move/move.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./move.vue?vue&type=template&id=26cfd3dc&scoped=true&\"\nvar renderjs\nimport script from \"./move.vue?vue&type=script&lang=js&\"\nexport * from \"./move.vue?vue&type=script&lang=js&\"\nimport style0 from \"./move.vue?vue&type=style&index=0&id=26cfd3dc&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"26cfd3dc\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/sprots/move/move.vue\"\nexport default component.exports","export * from \"-!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./move.vue?vue&type=template&id=26cfd3dc&scoped=true&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./move.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./move.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"container\">\r\n\t\t<!-- 地图区域 -->\r\n\t\t<snapshot id=\"target\">\r\n\r\n\r\n\t\t\t<map id=\"map\" style=\"width: 100%; height: 70vh;border-radius: 5%;\" :latitude=\"latitude\"\r\n\t\t\t\t:longitude=\"longitude\" :polyline=\"polyline\" :markers=\"markers\" show-location />\r\n\t\t</snapshot>\t\r\n\r\n\t\t<!-- 显示时间和控制按钮 -->\r\n\t\t<view class=\"controls\">\r\n\t\t\t<view style=\"width: 100%; display: flex;flex-wrap:wrap-reverse;justify-content: center;\">\r\n\t\t\t\t<view style=\"font-weight: bold;border-bottom: 6rpx solid  #24c68a;\">{{sprot.name}}</view>\r\n\t\t\t</view>\r\n\r\n\t\t\t<!-- <text style=\"width: 100%; display: flex;flex-wrap:wrap-reverse;justify-content: center;margin-top: 20rpx;\"\r\n\t\t\t\tclass=\"time-text\">轨迹点: {{route.length}} </text> -->\r\n\r\n\t\t\r\n\t\t</view>\r\n\t\t<view class=\"\" style=\"width: 100%; height: 500px; position: absolute; left: -9999px;\">\r\n\t\t\t<canvas canvas-id=\"trackCanvas\" id=\"trackCanvas\" class=\"canvas\"\r\n\t\t\t\tstyle=\"width: 100%; height: 500px; position: absolute; left: -9999px;\"></canvas>\r\n\r\n\t\t</view>\r\n\t\r\n\r\n\r\n\t\t<view class=\"tqb-tabbar\">\r\n\r\n\r\n\r\n\r\n\t\t\t<view class=\"tqb-tabbar-body\">\r\n\r\n\t\t\t\t<view class=\"tqb-tabbar-item\" :key=\"index\">\r\n\t\t\t\t\t<view class=\"tqb-tabbar-item\" :key=\"index\">\r\n\t\t\t\t\t\t<view class=\"tabbar-item-body\">\r\n\r\n\t\t\t\t\t\t\t<view class=\"active\"\r\n\t\t\t\t\t\t\t\tstyle=\"background-color: #000000;border-radius: 5%; color: white;padding: 5%;width: 180rpx;\">\r\n\t\t\t\t\t\t\t\t{{formattedTime}}\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\r\n\t\t\t\t\t</view>\r\n\r\n\t\t\t\t</view>\r\n\r\n\t\t\t\t<view class=\"tqb-tabbar-item\" :key=\"index\" @click=\"startRunning()\">\r\n\t\t\t\t\t<view class=\"tabbar-item-body\">\r\n\t\t\t\t\t\t<view class=\"tabbar-item-icon\" v-if=\"currentStatus == 0\">\r\n\t\t\t\t\t\t\t<image :src=\"tabBarList[currentStatus].iconPath\" style=\"width: 70rpx; height: 70rpx;\">\r\n\t\t\t\t\t\t\t</image>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"tabbar-item-icon-end\" v-if=\"currentStatus == 1\">\r\n\t\t\t\t\t\t\t<image :src=\"tabBarList[currentStatus].iconPath\" style=\"width: 120rpx; height: 120rpx;\">\r\n\t\t\t\t\t\t\t</image>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"active\">{{ tabBarList[currentStatus].text }}</view>\r\n\t\t\t\t\t</view>\r\n\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"tqb-tabbar-item\" :key=\"index\">\r\n\t\t\t\t\t<view class=\"tabbar-item-body\">\r\n\r\n\t\t\t\t\t\t<view @click=\"exportTrackImage\" class=\"active\"\r\n\t\t\t\t\t\t\tstyle=\"background-color: #000000;border-radius: 5%; color: white;padding: 5%;width: 180rpx;margin-left: -20rpx;\">\r\n\t\t\t\t\t\t\t轨迹图 </view>\r\n\t\t\t\t\t</view>\r\n\r\n\t\t\t\t</view>\r\n\r\n\t\t\t</view>\r\n\r\n\r\n\t\t\t<canvas id=\"captureCanvas\" canvas-id=\"captureCanvas\" style=\"width: 100%; height: 100%;\" hidden></canvas>\r\n\r\n\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\tvar graceJS = require('@/GraceUI5/js/grace.js');\r\n\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tlatitude: 0, // 当前纬度\r\n\t\t\t\tlongitude: 0, // 当前经度\r\n\t\t\t\troute: [], // 运动轨迹点数组\r\n\t\t\t\tpolyline: [], // 地图轨迹线数据\r\n\t\t\t\tmarkers: [], // 起点和终点标记\r\n\t\t\t\ttimer: null, // 定时器对象\r\n\t\t\t\ttimer_time: null,\r\n\t\t\t\tseconds: 0, // 运动时长（秒）\r\n\t\t\t\trunning: false, // 是否处于运动中\r\n\t\t\t\tcurrentStatus: 0,\r\n\t\t\t\ttabBarList: [{\r\n\t\t\t\t\t\ttext: '',\r\n\t\t\t\t\t\ticonPath: '/static/go.png',\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttext: '',\r\n\t\t\t\t\t\ticonPath: '/static/end.png',\r\n\t\t\t\t\t},\r\n\t\t\t\t],\r\n\t\t\t\tvisible: false,\r\n\t\t\t\tweight:60,\r\n\t\t\t\tsprot:{\r\n\t\t\t\t\timg:\"https://s1.aigei.com/src/img/png/65/65698ed3a383420fb713b91bb46ab094.png?imageMogr2/auto-orient/thumbnail/!282x282r/gravity/Center/crop/282x282/quality/85/%7CimageView2/2/w/282&e=2051020800&token=P7S2Xpzfz11vAkASLTkfHN7Fw-oOZBecqeJaxypL:J_YcCl__nC-XaFysZwdRH2zMKFA=\",\r\n\t\t\t\t\tname:\"自由跑\",\r\n\t\t\t\t\tisSubmit:true,\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\t// 格式化时间（HH:mm:ss）\r\n\t\t\tformattedTime() {\r\n\t\t\t\tconst h = Math.floor(this.seconds / 3600).toString().padStart(2, '0');\r\n\t\t\t\tconst m = Math.floor((this.seconds % 3600) / 60).toString().padStart(2, '0');\r\n\t\t\t\tconst s = (this.seconds % 60).toString().padStart(2, '0');\r\n\t\t\t\treturn `${h}:${m}:${s}`;\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// 获取当前位置并更新到地图上\r\n\t\t\tgetCurrentLocation() {\r\n\t\t\t\tuni.getLocation({\r\n\t\t\t\t\ttype: 'gcj02',\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tthis.latitude = res.latitude;\r\n\t\t\t\t\t\tthis.longitude = res.longitude;\r\n\r\n\t\t\t\t\t\tif (this.running) {\r\n\t\t\t\t\t\t\t// 记录轨迹点\r\n\t\t\t\t\t\t\tthis.route.push({\r\n\t\t\t\t\t\t\t\tlatitude: res.latitude,\r\n\t\t\t\t\t\t\t\tlongitude: res.longitude\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t// 更新轨迹线\r\n\t\t\t\t\t\t\tthis.polyline = [{\r\n\t\t\t\t\t\t\t\tpoints: this.route,\r\n\t\t\t\t\t\t\t\tcolor: '#FF0000DD',\r\n\t\t\t\t\t\t\t\twidth: 6\r\n\t\t\t\t\t\t\t}];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\tconsole.error('获取定位失败:', err);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\t// 开始运动逻辑\r\n\t\t\tstartRunning() {\r\n\t\t\t\tif (this.currentStatus == 1) {\r\n\t\t\t\t\tconsole.log(\"暂停\")\r\n\t\t\t\t\tthis.stopRunning()\r\n\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.log(\"开始\")\r\n\t\t\t\t\tthis.currentStatus = 1\r\n\t\t\t\t\tthis.running = true;\r\n\t\t\t\t\tthis.seconds = 0;\r\n\t\t\t\t\tthis.route = [];\r\n\t\t\t\t\tthis.markers = [];\r\n\t\t\t\t\tthis.getCurrentLocation(); // 初始点\r\n\r\n\t\t\t\t\tthis.timer_time = setInterval(() => {\r\n\t\t\t\t\t\tthis.seconds++;\r\n\r\n\t\t\t\t\t}, 1000); // 每5秒定位一次\r\n\t\t\t\t\t// 启动定时器，记录时间与位置\r\n\t\t\t\t\tthis.timer = setInterval(() => {\r\n\t\t\t\t\t\tthis.getCurrentLocation();\r\n\t\t\t\t\t}, 5000); // 每5秒定位一次\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\r\n\t\t\t// 结束运动逻辑\r\n\t\t\tstopRunning() {\r\n\t\t\t\tthis.currentStatus = 0\r\n\t\t\t\tclearInterval(this.timer);\r\n\t\t\t\tclearInterval(this.timer_time);\r\n\r\n\t\t\t\tthis.running = false;\r\n\r\n\t\t\t\tif (this.route.length > 0) {\r\n\t\t\t\t\t// 添加起点和终点标记\r\n\t\t\t\t\tthis.markers = [{\r\n\t\t\t\t\t\t\tid: 0,\r\n\t\t\t\t\t\t\tlatitude: this.route[0].latitude,\r\n\t\t\t\t\t\t\tlongitude: this.route[0].longitude,\r\n\t\t\t\t\t\t\ttitle: '起点',\r\n\t\t\t\t\t\t\ticonPath: '/static/start.png',\r\n\t\t\t\t\t\t\twidth: 30,\r\n\t\t\t\t\t\t\theight: 30\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tid: 1,\r\n\t\t\t\t\t\t\tlatitude: this.route[this.route.length - 1].latitude,\r\n\t\t\t\t\t\t\tlongitude: this.route[this.route.length - 1].longitude,\r\n\t\t\t\t\t\t\ttitle: '终点',\r\n\t\t\t\t\t\t\ticonPath: '/static/jl.png',\r\n\t\t\t\t\t\t\twidth: 30,\r\n\t\t\t\t\t\t\theight: 30\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t];\r\n\r\n\t\t\t\t\tconst distance = this.calculateDistance(this.route);\r\n\t\t\t\t\tconst calories = this.calculateCalories(distance, this.seconds);\r\n\t\t\t\t\t\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\ttitle: '运动完成',\r\n\t\t\t\t\t\tcontent: `用时：${this.formattedTime}\\n距离：${distance.toFixed(2)} km\\n热量：${calories.toFixed(0)} kcal`\r\n\t\t\t\t\t});\r\n\t\t\t\t\tconsole.log(\"轨迹\")\r\n\t\t\t\t\tconsole.log(this.route)\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar params = {\r\n\t\t\t\t\t\tcType: 4,\r\n\t\t\t\t\t\tcValue: calories.toFixed(0),\r\n\t\t\t\t\t\tcName: this.sprot.name,\r\n\t\t\t\t\t\tcId: 1,\r\n\t\t\t\t\t\tcImg: this.sprot.img,\r\n\t\t\t\t\t\tuid: graceJS.getStorage(\"id\"),\r\n\t\t\t\t\t\tcNum: (this.seconds / 60).toFixed(0),\r\n\t\t\t\t\t\tcWeight: 60,\r\n\t\t\t\t\t\tcreateTime: null\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconsole.log(params)\r\n\t\t\t\t\tif(this.seconds > 60){\r\n\t\t\t\t\t\tuni.gRequest.post(\"bohe/addCalory\", {\r\n\t\t\t\t\t\t\tdata: params\r\n\t\t\t\t\t\t}, (res) => {\r\n\t\t\t\t\t\t\tconsole.log(res.data)\r\n\t\t\t\t\t\t\tif (res.data.code == 200) {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t// 计算路线总距离（单位 km）\r\n\t\t\tcalculateDistance(points) {\r\n\t\t\t\tlet total = 0;\r\n\t\t\t\tfor (let i = 1; i < points.length; i++) {\r\n\t\t\t\t\tconst p1 = points[i - 1],\r\n\t\t\t\t\t\tp2 = points[i];\r\n\t\t\t\t\ttotal += this.getDistance(p1.latitude, p1.longitude, p2.latitude, p2.longitude);\r\n\t\t\t\t}\r\n\t\t\t\treturn total;\r\n\t\t\t},\r\n\r\n\t\t\t// 计算两点间距离（Haversine公式，单位km）\r\n\t\t\tgetDistance(lat1, lon1, lat2, lon2) {\r\n\t\t\t\tconst R = 6371; // 地球半径（km）\r\n\t\t\t\tconst dLat = (lat2 - lat1) * Math.PI / 180;\r\n\t\t\t\tconst dLon = (lon2 - lon1) * Math.PI / 180;\r\n\t\t\t\tconst a =\r\n\t\t\t\t\tMath.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n\t\t\t\t\tMath.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *\r\n\t\t\t\t\tMath.sin(dLon / 2) * Math.sin(dLon / 2);\r\n\t\t\t\tconst c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n\t\t\t\treturn R * c;\r\n\t\t\t},\r\n\r\n\t\t\t// 简单热量估算公式\r\n\t\t\tcalculateCalories(distance, seconds) {\r\n\t\t\t\t\r\n\t\t\t\tconst weight = this.weight; // 假设用户体重 60kg\r\n\t\t\t\tconst hours = seconds / 3600;\r\n\t\t\t\tconst speed = distance / hours;\r\n\t\t\t\tconst MET = speed < 8 ? 6 : 9.8; // 慢跑或快跑\r\n\t\t\t\treturn MET * weight * hours;\r\n\t\t\t},\r\n\r\n\t\t\t// 将经纬度转换为 canvas 坐标（这部分逻辑视你的坐标系统/地图缩放而定）\r\n\t\t\tconvertToCanvasCoord(lat, lng) {\r\n\t\t\t\t// 示例：你需要根据自己的缩放逻辑转换\r\n\t\t\t\treturn {\r\n\t\t\t\t\tx: (lng - 108.5) * 1000,\r\n\t\t\t\t\ty: (34.5 - lat) * 1000\r\n\t\t\t\t};\r\n\t\t\t},\r\n\r\n\t\t\texportTrackImage() {\r\n\t\t\t\tif (this.currentStatus == 1) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '跑步中不可生成哦！',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.route.length < 2) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '轨迹太短无法导出，试试跑远一点',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\t// 起点终点图片路径（建议为本地图片）\r\n\t\t\t\tconst startImg = '/static/start.png';\r\n\t\t\t\tconst endImg = '/static/jl.png';\r\n\r\n\t\t\t\tconst ctx = uni.createCanvasContext('trackCanvas', this);\r\n\r\n\t\t\t\t// 设置画布尺寸（你可以改大一些以提高清晰度）\r\n\t\t\t\tconst width = 360;\r\n\t\t\t\tconst height = 500;\r\n\r\n\t\t\t\t// 1. 经纬度归一化（求边界）\r\n\t\t\t\tconst lats = this.route.map(p => p.latitude);\r\n\t\t\t\tconst lngs = this.route.map(p => p.longitude);\r\n\t\t\t\tconst minLat = Math.min(...lats);\r\n\t\t\t\tconst maxLat = Math.max(...lats);\r\n\t\t\t\tconst minLng = Math.min(...lngs);\r\n\t\t\t\tconst maxLng = Math.max(...lngs);\r\n\r\n\t\t\t\tconst padding = 20; // 留白边距\r\n\t\t\t\tconst routeWidth = maxLng - minLng || 1;\r\n\t\t\t\tconst routeHeight = maxLat - minLat || 1;\r\n\r\n\t\t\t\tconst scaleX = (width - 2 * padding) / routeWidth;\r\n\t\t\t\tconst scaleY = (height - 2 * padding) / routeHeight;\r\n\t\t\t\tconst scale = Math.min(scaleX, scaleY); // 保证同比例缩放\r\n\r\n\t\t\t\t// 2. 计算居中偏移量\r\n\t\t\t\tconst offsetX = (width - (routeWidth * scale)) / 2;\r\n\t\t\t\tconst offsetY = (height - (routeHeight * scale)) / 2;\r\n\r\n\t\t\t\t// 3. 转换点为画布坐标（经纬度 → x/y）\r\n\t\t\t\tconst points = this.route.map(p => {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tx: (p.longitude - minLng) * scale + offsetX,\r\n\t\t\t\t\t\ty: height - ((p.latitude - minLat) * scale + offsetY) // y 轴反转\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// 4. 背景色或背景图绘制（任选其一）\r\n\r\n\t\t\t\t// ✅ 背景色\r\n\t\t\t\tctx.setFillStyle('#f8f8f8'); // 可以换成你喜欢的颜色\r\n\t\t\t\tctx.fillRect(0, 0, width, height);\r\n\r\n\t\t\t\t// ✅ 背景图（可选功能，需要在 static 文件夹下放图）\r\n\t\t\t\t// ctx.drawImage('/static/bg.jpg', 0, 0, width, height);\r\n\r\n\t\t\t\t// 5. 绘制轨迹折线\r\n\t\t\t\tctx.setStrokeStyle('#FF0000');\r\n\t\t\t\tctx.setLineWidth(4);\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.moveTo(points[0].x, points[0].y);\r\n\t\t\t\tpoints.forEach(p => ctx.lineTo(p.x, p.y));\r\n\t\t\t\tctx.stroke();\r\n\r\n\t\t\t\t// // 6. 绘制起点（绿色）和终点（蓝色）\r\n\t\t\t\tctx.setFillStyle('#00ff00');\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.arc(points[0].x, points[0].y, 6, 0, 2 * Math.PI);\r\n\t\t\t\tctx.fill();\r\n\r\n\t\t\t\tctx.setFillStyle('#0000ff');\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.arc(points[points.length - 1].x, points[points.length - 1].y, 6, 0, 2 * Math.PI);\r\n\t\t\t\tctx.fill();\r\n\r\n\t\t\t\t// 7. 渲染完成后导出图片\r\n\t\t\t\tctx.draw(false, () => {\r\n\t\t\t\t\tuni.canvasToTempFilePath({\r\n\t\t\t\t\t\tcanvasId: 'trackCanvas',\r\n\t\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\t\tuni.previewImage({\r\n\t\t\t\t\t\t\t\turls: [res.tempFilePath]\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail: err => {\r\n\t\t\t\t\t\t\tconsole.error('导出失败', err);\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: '导出失败',\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, this);\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\r\n\t\t\r\n\r\n\t\t},\r\n\r\n\r\n\r\n\t\t// 页面加载时初始化当前定位\r\n\t\tonLoad() {\r\n\t\t\tconst that = this\r\n\t\t\ttry {\r\n\t\t\t\tuni.authorize({\r\n\t\t\t\t\tscope: 'scope.userLocation',\r\n\t\t\t\t\tsuccess() {\r\n\t\t\t\t\t\t// 获取定位\r\n\t\t\t\t\t\tthat.getCurrentLocation();\r\n\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail() {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '请允许定位权限',\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tconst weight = graceJS.getStorage(\"weight\");\r\n\t\t\t\tif(weight > 0){\r\n\t\t\t\t\tthis.weight = weight\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tthis.getCurrentLocation();\r\n\t\t\t}\r\n\r\n\r\n\r\n\t\t}\r\n\t};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t.container {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t}\r\n\r\n\t.controls {\r\n\t\tpadding: 20rpx;\r\n\t\tbackground: #fff;\r\n\t\tmargin-top: 100rpx;\r\n\t}\r\n\r\n\t.time-text {\r\n\t\tfont-size: 36rpx;\r\n\t\tfont-weight: bold;\r\n\t\tmargin-bottom: 20rpx;\r\n\t\tdisplay: block;\r\n\t}\r\n\r\n\t.button-group {\r\n\t\tdisplay: flex;\r\n\t\tgap: 20rpx;\r\n\t}\r\n\r\n\t.canvas {\r\n\t\tmargin: 20rpx 0;\r\n\t\t// border: 1px solid #ccc;\r\n\t}\r\n\r\n\r\n\r\n\t.tqb-tabbar {\r\n\t\tposition: fixed;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\twidth: 100%;\r\n\t\tz-index: 1000;\r\n\t}\r\n\r\n\t.tqb-tabbar-body {\r\n\t\tborder-radius: 80rpx;\r\n\t\theight: 120rpx;\r\n\t\tdisplay: flex;\r\n\t\tbackground: linear-gradient(to right, #ffffff, #F1EDFF);\r\n\t\tposition: fixed;\r\n\t\tbottom: 68rpx;\r\n\t\twidth: 704rpx;\r\n\t\tleft: 24rpx;\r\n\t\tz-index: 1001;\r\n\t\tpadding-top: 20rpx;\r\n\t\tpadding-bottom: 20rpx;\r\n\t\talign-items: center;\r\n\t\tbox-shadow: 0px 0px 22rpx 9rpx rgba(0, 0, 0, 0.1);\r\n\r\n\t\t.tqb-tabbar-item {\r\n\t\t\tflex: 1;\r\n\t\t\tdisplay: flex;\r\n\t\t\tjustify-content: center;\r\n\t\t\ttext-align: center;\r\n\r\n\t\t\t.tabbar-item-icon-end {\r\n\t\t\t\twidth: 120rpx;\r\n\t\t\t\theight: 120rpx;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\tborder-radius: 50%;\r\n\t\t\t\t/* 设置为圆形 */\r\n\t\t\t\toverflow: hidden;\r\n\t\t\t\t/* 防止内部图片超出圆形边界 */\r\n\t\t\t}\r\n\r\n\t\t\t.tabbar-item-icon {\r\n\t\t\t\twidth: 120rpx;\r\n\t\t\t\theight: 120rpx;\r\n\t\t\t\tbackground-color: #24c68a;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\tborder-radius: 50%;\r\n\t\t\t\t/* 设置为圆形 */\r\n\t\t\t\toverflow: hidden;\r\n\t\t\t\t/* 防止内部图片超出圆形边界 */\r\n\t\t\t}\r\n\r\n\t\t\t.tab-bar-text {\r\n\t\t\t\tcolor: #999999;\r\n\t\t\t\tfont-size: 22rpx;\r\n\t\t\t\tmargin-top: 9rpx;\r\n\t\t\t}\r\n\r\n\t\t\t.active {\r\n\t\t\t\tcolor: #645AEE;\r\n\t\t\t}\r\n\r\n\t\t\t.add-icon {\r\n\t\t\t\twidth: 88rpx;\r\n\t\t\t\theight: 88rpx;\r\n\t\t\t\tposition: relative;\r\n\t\t\t\ttop: -8rpx;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t.mask-close {\r\n\t\tposition: absolute;\r\n\t\ttop: 32rpx;\r\n\t\tright: 32rpx;\r\n\t}\r\n\r\n\t.tqb-tabbar-popup {\r\n\t\tposition: fixed;\r\n\t\tbottom: 0;\r\n\t\tleft: 0;\r\n\t\twidth: 100%;\r\n\t\tbackground: linear-gradient(180deg, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.49) 32%, rgba(0, 0, 0, 0.66) 100%);\r\n\t\theight: 660rpx;\r\n\r\n\r\n\r\n\t}\r\n\r\n\t.popup-body {\r\n\t\tdisplay: flex;\r\n\t\tflex-wrap: wrap;\r\n\t\tposition: absolute;\r\n\t\ttop: 142rpx;\r\n\t\twidth: 100%;\r\n\r\n\r\n\t}\r\n\r\n\t.popup-item-icon {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t}\r\n\r\n\t.popup-item {\r\n\t\twidth: 20%;\r\n\t\tmargin-bottom: 20rpx;\r\n\t\ttext-align: center;\r\n\r\n\r\n\r\n\r\n\t}\r\n\r\n\t.popup-item-text {\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #fff;\r\n\t}\r\n</style>","import mod from \"-!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./move.vue?vue&type=style&index=0&id=26cfd3dc&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./move.vue?vue&type=style&index=0&id=26cfd3dc&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1746358524633\n      var cssReload = require(\"G:/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}